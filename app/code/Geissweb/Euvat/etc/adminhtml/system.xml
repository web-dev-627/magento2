<?xml version="1.0"?>
<!--
/**
 * ||GEISSWEB| EU VAT Enhanced
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the GEISSWEB End User License Agreement
 * that is available through the world-wide-web at this URL: https://www.geissweb.de/legal-information/eula
 *
 * DISCLAIMER
 *
 * Do not edit this file if you wish to update the extension in the future. If you wish to customize the extension
 * for your needs please refer to our support for more information.
 *
 * @copyright   Copyright (c) 2015 GEISS WeblÃ¶sungen (https://www.geissweb.de)
 * @license     https://www.geissweb.de/legal-information/eula GEISSWEB End User License Agreement
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:module:Magento_Config:etc/system_file.xsd">
    <system>
        <section id="euvat" translate="label" sortOrder="304" showInDefault="1" showInWebsite="1" showInStore="1">
            <class>separator-top</class>
            <label>EU VAT Enhanced</label>
            <tab>sales</tab>
            <resource>Geissweb_Euvat::config</resource>

            <group id="mod_info" translate="label" sortOrder="10" showInDefault="1" showInWebsite="1" showInStore="1">
                <label>Module Information</label>
                <field id="version_info" translate="label" type="label" sortOrder="5" showInDefault="1" showInStore="0" showInWebsite="0">
                    <label>Version/Support</label>
                    <frontend_model>Geissweb\Euvat\Model\System\Config\Extension</frontend_model>
                </field>
                <field id="license_key" translate="label,comment" type="text" sortOrder="10" showInDefault="1" showInWebsite="0" showInStore="0">
                    <label>License Key</label>
                    <comment><![CDATA[Get your license keys <a href='https://www.geissweb.de/customer/account/' target='_blank'>here</a>.]]></comment>
                    <validate>required-entry</validate>
                </field>
                <field id="installation_type" type="select" sortOrder="20" showInDefault="1" showInWebsite="0" showInStore="0">
                    <label>Installation Type</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\InstallationTypes</source_model>
                    <comment><![CDATA[If this is your production Magento installation, please select 'Production'.]]></comment>
                    <validate>validate-select</validate>
                </field>
                <field id="debug" translate="label,comment" type="select" sortOrder="100" showInDefault="1" showInStore="1" showInWebsite="1">
                    <label>Debug Mode</label>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <comment><![CDATA[Enable or disable debug logging. It is strongly recommended to disable it after debugging.]]></comment>
                </field>
            </group>

            <group id="interface_settings"  translate="label" sortOrder="15" showInDefault="1" showInWebsite="1" showInStore="1">
                <label>Interface Settings</label>
                <field id="requester_vat_number" translate="label,comment" type="text" sortOrder="15" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Requester VAT Number</label>
                    <validate>validate-alphanum</validate>
                    <comment><![CDATA[The requester VAT number must belong to the domestic country configured below in the VAT Settings. It will be used for the validation request to the interface.]]></comment>
                </field>
                <field id="interface" translate="label,comment" type="select" sortOrder="20" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Validation Interface</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\Interfaces</source_model>
                    <validate>validate-select</validate>
                </field>
                <field id="ip_compat" translate="label,comment" type="select" sortOrder="21" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>IPv6 Compatibility</label>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <comment>This binds your server IPv4 address to the request made to VIES instead of using your IPv6 address. You might need to enable this depending on your hosting environment. Enable it if you have problems with VIES connectivity.</comment>
                    <depends><field id="interface">Vies</field></depends>
                </field>
                <field id="ipv4_address" translate="label,comment" type="text" sortOrder="22" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>IPv4 Address of your server</label>
                    <comment>Your IPv4 server address (example: 192.168.100.10)</comment>
                    <depends><field id="ip_compat">1</field></depends>
                    <validate>ipv4</validate>
                </field>
                <field id="use_offline_validation" translate="label,comment" type="select" sortOrder="23" showInDefault="1" showInStore="1" showInWebsite="1">
                    <label>Offline Validation Fallback</label>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <comment>Accept VAT numbers as valid when syntax is correct but validation interface is unavailable (offline, member state offline or not responding due to timeout).</comment>
                </field>
                <field id="offline_validation_countries" translate="label,comment" type="multiselect" sortOrder="24" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Offline Validation Countries</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\EuCountries</source_model>
                    <comment>Apply the offline fallback only for these countries.</comment>
                    <depends>
                        <field id="use_offline_validation">1</field>
                    </depends>
                </field>
            </group>

            <group id="vat_settings" translate="label" sortOrder="20" showInDefault="1" showInWebsite="1" showInStore="1">
                <label>VAT Settings</label>
                <field id="domestic_country" translate="label,comment" type="select" sortOrder="0" showInDefault="1" showInStore="1" showInWebsite="1">
                    <label>Domestic country</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\EuCountries</source_model>
                    <comment>Amongst other things, the domestic country is used to identify domestic business customers.</comment>
                </field>
                <field id="use_vat_calculation" translate="label,comment" type="select" sortOrder="10" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Use dynamic customer tax class</label>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <comment>Use dynamic application of customer tax class, independet from the customer group.</comment>
                </field>
                <field id="tax_class_including_consumer" translate="label,comment" type="select" sortOrder="30" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Tax class consumer incl. VAT</label>
                    <source_model>Magento\Tax\Model\TaxClass\Source\Customer</source_model>
                    <comment>Choose the class, for customers from your domestic country or without (or invalid) VAT Number.</comment>
                    <depends>
                        <field id="use_vat_calculation">1</field>
                    </depends>
                </field>
                <field id="tax_class_including_business" translate="label,comment" type="select" sortOrder="40" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Tax class business incl. VAT</label>
                    <source_model>Magento\Tax\Model\TaxClass\Source\Customer</source_model>
                    <comment>Choose the class, for customers from your domestic country with valid VAT Number.</comment>
                    <depends>
                        <field id="use_vat_calculation">1</field>
                    </depends>
                </field>
                <field id="tax_class_excluding_business" translate="label,comment" type="select" sortOrder="50" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Tax class business excl. VAT</label>
                    <source_model>Magento\Tax\Model\TaxClass\Source\Customer</source_model>
                    <comment>Choose the class, for customers from EU countries with valid VAT Number.</comment>
                    <depends>
                        <field id="use_vat_calculation">1</field>
                    </depends>
                </field>
                <field id="fixed_taxcalc_groups" translate="label,comment" type="multiselect" sortOrder="55" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Do not use dynamic tax class for these groups</label>
                    <comment>Fixed tax calculation based on the customer tax class of the customer group.</comment>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\CustomerGroups</source_model>
                    <depends>
                        <field id="use_vat_calculation">1</field>
                    </depends>
                </field>
                <field id="always_vat_countries" translate="label,comment" type="multiselect" sortOrder="56" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Always including VAT countries</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\EuCountries</source_model>
                    <comment>Even with a valid VAT number, always calculate VAT for these countries (requires a tax rate for this country in the tax rule to calculate VAT). It is not required to select the domestic country here.</comment>
                    <depends>
                        <field id="use_vat_calculation">1</field>
                    </depends>
                </field>
                <field id="disable_cbt_noneu" translate="label,comment" type="select" sortOrder="59" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Disable Cross-Border-Trade (for non EU)</label>
                    <comment>Order totals will be net (without VAT) instead gross for these customers. Applies only when CBT is enabled.</comment>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                </field>
                <field id="disable_cbt_eub2b" translate="label,comment" type="select" sortOrder="60" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Disable Cross-Border-Trade (for valid VAT numbers)</label>
                    <comment>Order totals will be net (without VAT) instead gross for these customers. Applies only when CBT is enabled.</comment>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                </field>
                <field id="threshold_enabled" translate="label,comment" type="select" sortOrder="64" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Enable Threshold countries</label>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <comment>IF you exceeded the threshold for a country, select it here to calculate the net price according the tax rate for this country instead of your domestic country. Will only work when admin prices are used including tax.</comment>
                </field>
                <field id="threshold_countries" translate="label,comment" type="multiselect" sortOrder="65" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Threshold Countries</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\EuCountries</source_model>
                    <depends>
                        <field id="threshold_enabled">1</field>
                    </depends>
                </field>
            </group>

            <group id="brexit_settings" translate="label" sortOrder="21" showInDefault="1" showInWebsite="1" showInStore="1">
                <label>Brexit</label>
                <comment><![CDATA[The UK VAT Threshold calculation requires "Use dynamic customer tax class" from above to be enabled.]]></comment>
                <field id="threshold_enabled" translate="label,comment" type="select" sortOrder="10" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Enable UK VAT Threshold calculation</label>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <comment>Calculate VAT unless threshold is exceeded.</comment>
                </field>
                <field id="threshold_value" translate="label,comment" type="text" sortOrder="15" showInDefault="1" showInWebsite="1" showInStore="1">
                    <label>Threshold value</label>
                    <depends>
                        <field id="threshold_enabled">1</field>
                    </depends>
                    <comment>In GBP</comment>
                </field>
            </group>

            <group id="shipping_vat_settings" translate="label" sortOrder="25" showInDefault="1" showInWebsite="1" showInStore="1">
                <label>Shipping VAT Settings</label>
                <field id="use_dynamic_shipping_calculation" translate="label,comment" type="select" sortOrder="100" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Use dynamic shipping tax class</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\DynamicShipping</source_model>
                    <comment>Apply the reduced shipping tax class for shipping tax, when the reduced products in cart have the largest total, or apply the highest tax class/rate found in cart.</comment>
                </field>
                <field id="reduced_product_class" translate="label,comment" showInWebsite="1" showInStore="1" showInDefault="1" sortOrder="110" type="select">
                    <label>Reduced product tax class</label>
                    <source_model>Magento\Tax\Model\TaxClass\Source\Product</source_model>
                    <comment>Please select the product tax class for reduced products.</comment>
                    <depends>
                        <field id="use_dynamic_shipping_calculation" separator=",">1,2</field>
                    </depends>
                </field>
                <field id="reduced_shipping_class" translate="label,comment" showInWebsite="1" showInStore="1" showInDefault="1" sortOrder="110" type="select">
                    <label>Reduced shipping tax class</label>
                    <source_model>Magento\Tax\Model\TaxClass\Source\Product</source_model>
                    <comment>Please select the shipping tax class for reduced shipping.</comment>
                    <depends>
                        <field id="use_dynamic_shipping_calculation" separator=",">1,2</field>
                    </depends>
                </field>
                <field id="super_reduced_product_class" translate="label,comment" showInWebsite="1" showInStore="1" showInDefault="1" sortOrder="120" type="select">
                    <label>Super reduced product tax class</label>
                    <source_model>Magento\Tax\Model\TaxClass\Source\Product</source_model>
                    <comment>Please select the product tax class for super reduced products.</comment>
                    <depends>
                        <field id="use_dynamic_shipping_calculation" separator=",">1,2</field>
                    </depends>
                </field>
                <field id="super_reduced_shipping_class" translate="label,comment" showInWebsite="1" showInStore="1" showInDefault="1" sortOrder="121" type="select">
                    <label>Super reduced shipping tax class</label>
                    <source_model>Magento\Tax\Model\TaxClass\Source\Product</source_model>
                    <comment>Please select the shipping tax class for super reduced shipping.</comment>
                    <depends>
                        <field id="use_dynamic_shipping_calculation" separator=",">1,2</field>
                    </depends>
                </field>
            </group>

            <group id="group_assignment" translate="label" sortOrder="30" showInDefault="1" showInWebsite="1" showInStore="1">
                <label>Group Assignment</label>
                <field id="use_group_assignment" translate="label,comment" type="select" sortOrder="5" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Use customer group assignment</label>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <comment>Assign customers to groups based on their default billing address and VAT Number validation data.</comment>
                </field>
                <field id="assign_customergroup_on_guest_order" translate="label,comment" type="select" sortOrder="6" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Overwrite actual customer group on guest orders</label>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <comment>Useful for ERP integration, where tax status is determined by customer group.</comment>
                    <depends><field id="use_group_assignment">1</field></depends>
                </field>
                <field id="target_group_eu" translate="label,comment" type="select" sortOrder="10" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Group for business with valid VAT-ID</label>
                    <comment>Set the desired customer group for EU business customers with valid VAT-ID.</comment>
                    <source_model>Magento\Customer\Model\Config\Source\Group</source_model>
                    <depends><field id="use_group_assignment">1</field></depends>
                </field>
                <field id="target_group_domestic" translate="label,comment" type="select" sortOrder="20" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Group for domestic businesses</label>
                    <comment>Set the desired business customer group for customers with valid VAT number from the store country.</comment>
                    <source_model>Magento\Customer\Model\Config\Source\Group</source_model>
                    <depends><field id="use_group_assignment">1</field></depends>
                </field>
                <field id="target_group_outside" translate="label,comment" type="select" sortOrder="30" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Group for customers outside EU</label>
                    <comment>Set the desired customer group for foreign customers outside the EU.</comment>
                    <source_model>Magento\Customer\Model\Config\Source\Group</source_model>
                    <depends><field id="use_group_assignment">1</field></depends>
                </field>
                <field id="target_group_invalid" translate="label,comment" type="select" sortOrder="40" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Group for customers with invalid VAT numbers</label>
                    <comment>Set the desired group for customers who used an invalid VAT number (validated through the interface).</comment>
                    <source_model>Magento\Customer\Model\Config\Source\Group</source_model>
                    <depends><field id="use_group_assignment">1</field></depends>
                </field>
                <field id="target_group_errors" translate="label,comment" type="select" sortOrder="50" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Group for customers on technical errors</label>
                    <comment>Customers will be assigned to this group, if the interface did not respond due to maintenance or connection errors.</comment>
                    <source_model>Magento\Customer\Model\Config\Source\Group</source_model>
                    <depends><field id="use_group_assignment">1</field></depends>
                </field>
                <field id="excluded_groups" translate="label,comment" type="multiselect" sortOrder="60" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Excluded Groups</label>
                    <comment>The selected groups will be excluded from the group assignment after each address save. Use this for discount groups.</comment>
                    <source_model>Magento\Customer\Model\Config\Source\Group</source_model>
                    <depends><field id="use_group_assignment">1</field></depends>
                </field>
            </group>

            <group id="group_price_display" translate="label" sortOrder="35" showInDefault="1" showInWebsite="1" showInStore="1">
                <label>Price Display Type By Customer Group</label>
                <comment>Change the price display depending on the customer group. If you specify the customer group more than once in a ruleset, the first occurance is used.</comment>
                <field id="catalog_price_display" translate="label,comment" sortOrder="10" showInDefault="1" showInStore="1" showInWebsite="1">
                    <label>Catalog Product Price Display</label>
                    <frontend_model>Geissweb\Euvat\Model\System\Config\CustomerGroupPriceDisplay</frontend_model>
                    <backend_model>Magento\Config\Model\Config\Backend\Serialized\ArraySerialized</backend_model>
                    <comment>This only has effect on the display type, not if the actual prices are incl. or excl. VAT. Rules overwrite the default setting at tax configuration 'Display Product Prices In Catalog'.</comment>
                </field>
                <field id="cart_product_price_display" translate="label,comment" sortOrder="20" showInDefault="1" showInStore="1" showInWebsite="1">
                    <label>Cart Product Price Display</label>
                    <frontend_model>Geissweb\Euvat\Model\System\Config\CustomerGroupPriceDisplay</frontend_model>
                    <backend_model>Magento\Config\Model\Config\Backend\Serialized\ArraySerialized</backend_model>
                    <comment>This only has effect on the display type, not if the actual prices are incl. or excl. VAT. Rules overwrite the default setting at tax configuration 'Shopping Cart Display Settings => Display Prices'.</comment>
                </field>
                <field id="cart_subtotal_price_display" translate="label,comment" sortOrder="20" showInDefault="1" showInStore="1" showInWebsite="1">
                    <label>Cart Subtotal Price Display</label>
                    <frontend_model>Geissweb\Euvat\Model\System\Config\CustomerGroupPriceDisplay</frontend_model>
                    <backend_model>Magento\Config\Model\Config\Backend\Serialized\ArraySerialized</backend_model>
                    <comment>This only has effect on the display type, not if the actual prices are incl. or excl. VAT. Rules overwrite the default setting at tax configuration 'Shopping Cart Display Settings => Display Subtotal'.</comment>
                </field>
            </group>

            <group id="integration" translate="label" sortOrder="40" showInDefault="1" showInWebsite="1" showInStore="1">
                <label>Integration</label>
                <field id="enable_vat_field" translate="label,comment" type="select" sortOrder="20" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Enable VAT field functionality</label>
                    <comment>Enable or disable all field validation functionality.</comment>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <config_path>euvat/interface_settings/validate_vatid</config_path>
                </field>
                <field id="field_validation_registration" translate="label,comment" type="select" sortOrder="40" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Field validation at Customer Registration</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\ValidationOptions</source_model>
                    <depends><field id="enable_vat_field">1</field></depends>
                </field>
                <field id="field_validation_addressedit" translate="label,comment" type="select" sortOrder="42" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Field validation at Customer Address Edit</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\ValidationOptions</source_model>
                    <depends><field id="enable_vat_field">1</field></depends>
                </field>
                <field id="field_validation_checkout" translate="label,comment" type="select" sortOrder="44" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Field validation at Checkout</label>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\ValidationOptions</source_model>
                    <depends><field id="enable_vat_field">1</field></depends>
                </field>
                <field id="field_tooltip" translate="label,comment" type="text" sortOrder="50" showInDefault="1" showInWebsite="1" showInStore="1">
                    <label>VAT number field Tooltip</label>
                    <comment>Empty value will disable the tooltip.</comment>
                    <depends><field id="enable_vat_field">1</field></depends>
                </field>
                <field id="field_placeholder" translate="label,comment" type="text" sortOrder="55" showInDefault="1" showInWebsite="1" showInStore="1">
                    <label>VAT number field Placeholder</label>
                    <comment>Empty value will disable the placeholder.</comment>
                    <depends><field id="enable_vat_field">1</field></depends>
                </field>
                <field id="field_delay" translate="label,comment" type="text" sortOrder="60" showInDefault="1" showInWebsite="1" showInStore="1">
                    <label>VAT number field delay</label>
                    <comment>Enter the delay in milliseconds to validate numbers while customer types. 1000ms = 1 second, default 3000ms.</comment>
                    <depends><field id="enable_vat_field">1</field></depends>
                </field>
                <field id="visible_countries" translate="label,comment" type="multiselect" sortOrder="70" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Field visible countries</label>
                    <comment>Select for which countries the VAT number field should be visible.</comment>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\FieldVisibleCountries</source_model>
                    <depends><field id="enable_vat_field">1</field></depends>
                </field>
                <field id="ask_customer_country_correction" translate="label,comment" type="select" sortOrder="80" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Ask customer to set the country automatically</label>
                    <comment>If the country of the VAT number is different from the current country selection, ask the customer to automatically set the country according to the VAT number country.</comment>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                    <depends><field id="enable_vat_field">1</field></depends>
                </field>
                <field id="show_address_on_regpage" translate="label,comment" type="select" sortOrder="100" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Enable address fields on registration page</label>
                    <comment>Show the customer address fields, together with the VAT Number field on the registration page. The field is only displayed if Enable VAT field functionality is set to Yes, or you need to manually add it to the form.</comment>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                </field>
            </group>

            <group id="revalidation" translate="label" sortOrder="50" showInDefault="1" showInStore="1" showInWebsite="1">
                <label>Periodic Revalidation</label>
                <field id="periodic_check_enabled" translate="label,comment" type="select" sortOrder="20" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Enable Periodic Revalidation</label>
                    <comment>Select if VAT numbers should be validated on customer login if unvalidated or within revalidation period</comment>
                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
                </field>
                <field id="validation_period" translate="label,comment" type="select" sortOrder="30" showInWebsite="1" showInStore="1" showInDefault="1">
                    <label>Revalidation Period</label>
                    <comment>Please note that the more requests you do to the interface, the more likely it is that the validation fails for technical reasons.</comment>
                    <source_model>Geissweb\Euvat\Model\System\Config\Source\ValidationPeriod</source_model>
                    <depends><field id="periodic_check_enabled">1</field></depends>
                </field>
            </group>

        </section>
    </system>
</config>
